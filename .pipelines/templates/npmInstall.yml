steps:
  - script: yarn config set cache-folder $(YARN_CACHE_FOLDER)
    displayName: Yarn set cache folder

  - task: Cache@2
    displayName: Cache yarn
    inputs:
      key: yarn | $(cacheVersion) | $(Agent.OS) | yarn.lock
      restoreKeys: |
        yarn | $(cacheVersion) | $(Agent.OS)
        yarn | $(cacheVersion)
      path: $(YARN_CACHE_FOLDER)

  - task: Cache@2
    displayName: Cache Cypress
    inputs:
      key: cypress | $(cacheVersion) | $(Agent.OS) | yarn.lock
      restoreKeys: cypress | $(cacheVersion) | $(Agent.OS)
      path: $(cyCacheDir)
      cacheHitVar: CYPRESS_CACHE_RESTORED

  - task: Cache@2
    displayName: Cache nextjs
    inputs:
      key: next | $(cacheVersion) | $(Agent.OS) | yarn.lock
      restoreKeys: next | $(cacheVersion) | $(Agent.OS)
      path: $(nextCacheDir)
      cacheHitVar: NEXT_CACHE_RESTORED

  - script: |
      npm set-script prepare ""
      npm set-script postinstall ""
    displayName: Disable Scripts

  # Runs an install as long as a lockfile is present
  - script: yarn install --frozen-lockfile
    displayName: Install Packages via Yarn
